/**
 * AxonCreator - Website Builder
 *
 * NOTICE OF LICENSE
 *
 * @author    axonvip.com <support@axonvip.com>
 * @copyright 2021 axonvip.com
 * @license   You can not resell or redistribute this software.
 *
 * https://www.gnu.org/licenses/gpl-3.0.html
 */
var AxpsSearchModule;!function(d){"use strict";AxpsSearchModule={init:function(){this.mdCategoryDropdown(),this.mdSearch()},mdSearch:function(){d("body").on("shown.bs.modal","#search-popup",function(){var e,a,i=d("#search-popup").find("input[name=s]").val();d("#search-popup").find("input[name=s]").val("").focus().val(i),d(window).width()<768||(a=(e=d("#search-popup").find(".category-dropdown-inner")).innerWidth()+e.closest("form").find(".search-submit").innerWidth()+17,i="padding-right",d("body").hasClass("rtl")&&(i="padding-left"),e.closest("form").find("input[name=s]").css(i,a))});function a(){d("form.has-ajax-search").each(function(){var a,e,i,n,r,s,t,o,c=d(this);c.hasClass("fs-initialized")||(c.addClass("fs-initialized"),a='<div class="view-all-results view-all-products"><span>'+opSearch.all_results_product+"</span></div>",e=c.attr("action"),i=parseInt(opSearch.count),n=c.find('[name="c"]'),r="cart_default",s=c.closest(".search-wrapper").find(".search-results"),c.removeClass("has-ajax-search"),void 0!==opSearch.imageType&&""!=opSearch.imageType&&(r=opSearch.imageType),""!=opSearch.search_string&&c.find("input[name=s]").val(opSearch.search_string),c.find("input[name=s]").click(function(){3<=c.find("input[name=s]").val().length&&""!==s.find(".autocomplete-suggestions").html()&&s.find(".autocomplete-suggestions").css({display:"flex"})}),s.on("click",".view-all-products",function(){c.submit()}),c.find("input[name=s]").devbridgeAutocomplete({serviceUrl:e,appendTo:s,type:"POST",dataType:"json",paramName:"s",minChars:3,params:{c:n.val(),resultsPerPage:i,nrtAjax:1},onSelect:function(e){void 0!==e.permalink&&0<e.permalink.length&&(d("body").hasClass("product-id-"+e.id)?location.reload():window.location.href=e.permalink)},onSearchStart:function(e){c.addClass("search-loading")},beforeRender:function(e){d(e).find(".search-divider-text").parent().addClass("search-divider"),d(e).find(".no-result").parent().addClass("search-no-result"),d(e).find(".view-all-products").parent().replaceWith(a)},onSearchComplete:function(e,a){c.removeClass("search-loading")},transformResult:function(e){var s=[];return s.push({value:"",divider:opSearch.divider}),0<e.products.length?(e.products.forEach(function(e){var a=(e.has_discount?'<span class="regular-price">'+e.regular_price+"</span> ":"")+'<span class="price">'+e.price+"</span>",i="";e.cover&&void 0!==e.cover.bySize[r].url&&(i=e.cover.bySize[r].url);var n=opSearch.sku+" "+(e.reference||"N/A");s.push({id:e.id_product,value:e.name,permalink:e.url,price:e.show_price?a:"",thumbnail:'<img class="img-responsive" src="'+i+'" alt="" title="">',sku:n})}),s.push({value:"",view_all_products:!0,permalink:""})):s.push({value:opSearch.noProducts,no_found:!0,permalink:""}),{suggestions:s}},formatResult:function(e,a){var i="("+(a="&"===a?"&#038;":a).replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+")",a="";return e.divider&&(a+=' <h5 class="search-divider-text">'+e.divider+"</h5>"),e.thumbnail&&(a+=' <div class="search-thumb">'+e.thumbnail+"</div>"),e.value&&(a+='<h4 class="search-title">'+e.value.replace(new RegExp(i,"gi"),"<strong>$1</strong>").replace(/&lt;(\/?strong)&gt;/g,"<$1>")+"</h4>"),e.no_found&&(a='<div class="no-result">'+e.value+"</div>"),e.view_all_products&&(a='<div class="view-all-products"></div>'),e.sku&&(a+=' <div class="search-sku">'+e.sku+"</div>"),e.price&&(a+=' <div class="search-price">'+e.price+"</div>"),a}}),n.length&&(t=c.find("input[name=s]").devbridgeAutocomplete(),o=e,n.on("cat_selected",function(){t.setOptions({serviceUrl:o,params:{c:n.val(),resultsPerPage:i}}),t.hide(),t.onValueChange()})),d("body").on("click",function(e){e=e.target;d(e).is(".search-wrapper")||d(e).parents().is(".search-wrapper")||c.find("input[name=s]").devbridgeAutocomplete("hide")}),d(".search-results").on("click",function(e){e.stopPropagation()}))})}a(),prestashop.on("updatedProductList",function(e){a()})},mdCategoryDropdown:function(){d(".category-dropdown-inner").each(function(){var i,n,r,t=d(this);function o(){t.removeClass("shown")}function c(){var e,a;d(window).width()<768||(e=t.innerWidth()+t.closest("form").find(".search-submit").innerWidth()+17,a="padding-right",d("body").hasClass("rtl")&&(a="padding-left"),t.closest("form").find("input[name=s]").css(a,e))}t.hasClass("cd-initialized")||(t.addClass("cd-initialized"),i=t.find("> a"),n=t.find("> input"),r=t.find("> .list-wrapper"),opSearch.current_category_id&&(r.find(".active-item").removeClass("active-item"),r.find("a[data-value="+opSearch.current_category_id+"]").parent().addClass("active-item"),i.text(r.find("a[data-value="+opSearch.current_category_id+"]").text()),n.val(opSearch.current_category_id),r.find("ul:not(.children) > li:first-child").show()),c(),d("body").on("click",function(e){e=e.target;if(t.hasClass("shown")&&!d(e).is(".category-dropdown-inner")&&!d(e).parents().is(".category-dropdown-inner"))return o(),!1}),i.on("click",function(e){return e.preventDefault(),t.hasClass("shown")?o():(t.addClass("shown"),void 0!==d.fn.devbridgeAutocomplete&&t.closest("form").find("input[name=s]").devbridgeAutocomplete("hide")),!1}),r.on("click","a",function(e){e.preventDefault();var a=d(this).data("value"),e=d(this).text();r.find(".active-item").removeClass("active-item"),d(this).parent().addClass("active-item"),0!==a?r.find("ul:not(.children) > li:first-child").show():0===a&&r.find("ul:not(.children) > li:first-child").hide(),i.text(e),n.val(a).trigger("cat_selected"),o(),c()}))})}}}(jQuery),jQuery(document).ready(function(){AxpsSearchModule.init()});